<!doctype html><html lang=es dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Cómo sobreescribir solo algunos subdominios en tu red local | David Davó</title>
<meta name=keywords content="tutorial,dns,self-hosting,homelab"><meta name=description content="Si tienes una pequeña red en casa, alguna vez habrás tenido problemas con el tema de dominios. Como ya sabrás, está la IP pública (la que se ve desde fuera de tu red, y conecta con el router), y las IPs privadas (las de tu red local, que empiezan por 192.168.0&mldr;). Esta tecnología de asignar varias &ldquo;IP privadas&rdquo; a una única &ldquo;IP pública&rdquo; se llama enmascaramiento o &ldquo;Traducción de Direcciones de Red&rdquo; (NAT por sus siglas en inglés)."><meta name=author content="David Davó"><link rel=canonical href=https://blog.ddavo.me/es/posts/tutorials/bind-override/><link crossorigin=anonymous href=/assets/css/stylesheet.min.2cb91c9ff9fc7ccf4a784128404d9fae9cb333f46457e666d77841b08c8f4f8a.css integrity="sha256-LLkcn/n8fM9KeEEoQE2frpyzM/RkV+Zm13hBsIyPT4o=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.ddavo.me/favicon.ico><link rel=apple-touch-icon href=https://blog.ddavo.me/apple-touch-icon.png><link rel=alternate hreflang=en href=https://blog.ddavo.me/posts/tutorials/bind-override/><link rel=alternate hreflang=es href=https://blog.ddavo.me/es/posts/tutorials/bind-override/><meta name=twitter:title content="Cómo sobreescribir solo algunos subdominios en tu red local | David Davó"><meta name=twitter:description content="Si tienes una pequeña red en casa, alguna vez habrás tenido problemas con el tema de dominios. Como ya sabrás, está la IP pública (la que se ve desde fuera de tu red, y conecta con el router), y las IPs privadas (las de tu red local, que empiezan por 192.168.0&mldr;). Esta tecnología de asignar varias &ldquo;IP privadas&rdquo; a una única &ldquo;IP pública&rdquo; se llama enmascaramiento o &ldquo;Traducción de Direcciones de Red&rdquo; (NAT por sus siglas en inglés)."><meta property="og:title" content="Cómo sobreescribir solo algunos subdominios en tu red local | David Davó"><meta property="og:description" content="Si tienes una pequeña red en casa, alguna vez habrás tenido problemas con el tema de dominios. Como ya sabrás, está la IP pública (la que se ve desde fuera de tu red, y conecta con el router), y las IPs privadas (las de tu red local, que empiezan por 192.168.0&mldr;). Esta tecnología de asignar varias &ldquo;IP privadas&rdquo; a una única &ldquo;IP pública&rdquo; se llama enmascaramiento o &ldquo;Traducción de Direcciones de Red&rdquo; (NAT por sus siglas en inglés)."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.ddavo.me/es/posts/tutorials/bind-override/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-12-22T13:17:17+01:00"><meta property="article:modified_time" content="2021-12-22T13:17:17+01:00"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.ddavo.me/es/posts/"},{"@type":"ListItem","position":2,"name":"Cómo sobreescribir solo algunos subdominios en tu red local","item":"https://blog.ddavo.me/es/posts/tutorials/bind-override/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Cómo sobreescribir solo algunos subdominios en tu red local | David Davó","name":"Cómo sobreescribir solo algunos subdominios en tu red local","description":"Si tienes una pequeña red en casa, alguna vez habrás tenido problemas con el tema de dominios. Como ya sabrás, está la IP pública (la que se ve desde fuera de tu red, y conecta con el router), y las IPs privadas (las de tu red local, que empiezan por 192.168.0\u0026hellip;). Esta tecnología de asignar varias \u0026ldquo;IP privadas\u0026rdquo; a una única \u0026ldquo;IP pública\u0026rdquo; se llama enmascaramiento o \u0026ldquo;Traducción de Direcciones de Red\u0026rdquo; (NAT por sus siglas en inglés).","keywords":["tutorial","dns","self-hosting","homelab"],"wordCount":"1127","inLanguage":"es","datePublished":"2021-12-22T13:17:17+01:00","dateModified":"2021-12-22T13:17:17+01:00","author":{"@type":"Person","name":"David Davó"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.ddavo.me/es/posts/tutorials/bind-override/"},"publisher":{"@type":"Organization","name":"David Davó's dev log","logo":{"@type":"ImageObject","url":"https://blog.ddavo.me/favicon.ico"}}}</script><script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="//matomo.ddavo.me/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","4"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary-bg:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list-page{background:var(--theme)}.list-page:not(.dark)::-webkit-scrollbar-track{background:0 0}.list-page:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript></head><body class="type-posts kind-page layout-" id=top><script data-no-instant>function switchTheme(e){switch(e){case"light":document.body.classList.remove("dark");break;case"dark":document.body.classList.add("dark");break;default:window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")}}function isDarkTheme(){return document.body.className.includes("dark")}function getPrefTheme(){return localStorage.getItem("pref-theme")}function setPrefTheme(e){switchTheme(e),localStorage.setItem("pref-theme",e)}const toggleThemeCallbacks={};toggleThemeCallbacks.main=e=>{setPrefTheme(e?"light":"dark")},window.addEventListener("toggle-theme",function(){const e=isDarkTheme();for(const t in toggleThemeCallbacks)toggleThemeCallbacks[t](e)});function toggleThemeListener(){window.dispatchEvent(new CustomEvent("toggle-theme"))}</script><script>(function(){const t="light",e=getPrefTheme(),n=e||t;switchTheme(n)})()</script><header class=header><nav class=nav><div class=logo><a href=https://blog.ddavo.me/ accesskey=h title="David Davó's dev log (Alt + H)">David Davó's dev log</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://blog.ddavo.me/ title="🇬🇧 English" aria-label=":uk: English">🇬🇧 English</a></li></ul></span></div><ul id=menu></ul></nav></header><main class="main post"><article class=post-single><header class=post-header><h1 class=post-title>Cómo sobreescribir solo algunos subdominios en tu red local</h1><div class=post-meta><span class=meta-item><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg>
<span>2021-12-22</span></span><span class=meta-item>
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon" style="user-select:text"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z" style="user-select:text"/><line x1="7" y1="7" x2="7" y2="7" style="user-select:text"/></svg>
<span class=post-tags><a href=https://blog.ddavo.me/es/tags/tutorial/>Tutorial</a><a href=https://blog.ddavo.me/es/tags/dns/>Dns</a><a href=https://blog.ddavo.me/es/tags/self-hosting/>Self-Hosting</a><a href=https://blog.ddavo.me/es/tags/homelab/>Homelab</a></span></span><span class=meta-item>
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select:text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z" style="user-select:text"/><polyline points="14 2 14 8 20 8" style="user-select:text"/><line x1="16" y1="13" x2="8" y2="13" style="user-select:text"/><line x1="16" y1="17" x2="8" y2="17" style="user-select:text"/><polyline points="10 9 9 9 8 9" style="user-select:text"/></svg>
<span>1127 palabras</span></span><span class=meta-item>
<svg width="24" height="24" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>6 min</span></span><span class=meta-item>
<svg viewBox="0 0 24 24" width="24" height="24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M7 4c0 4.846.0 7 .5 8"/><path d="M10 8.5c0 2.286-2 4.5-3.5 4.5S4 11.865 4 11c0-2 1-3 3-3s5 .57 5 2.857c0 1.524-.667 2.571-2 3.143"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<span class=i18n-links><a href=https://blog.ddavo.me/posts/tutorials/bind-override/>🇬🇧 English</a></span></span></div></header><div class="toc side left"><details open><summary accesskey=c title="(Alt + C)"><span class=details>Tabla de Contenidos</span></summary><div class=inner><ul><li><a href=#bind-tu-servidor-dns-de-confianza aria-label="BIND: Tu servidor DNS de confianza">BIND: Tu servidor DNS de confianza</a></li><li><a href=#instalar-bind aria-label="Instalar bind">Instalar bind</a></li><li><a href=#configurando-bind aria-label="Configurando BIND">Configurando BIND</a><ul><li><a href=#arrancando-el-servidor aria-label="Arrancando el servidor">Arrancando el servidor</a></li><li><a href=#usando-el-servidor aria-label="Usando el servidor">Usando el servidor</a></li></ul></li><li><a href=#fuentes-y-m%c3%a1s-informaci%c3%b3n aria-label="Fuentes y más información">Fuentes y más información</a></li></ul></div></details></div><div class=post-content><p>Si tienes una pequeña red en casa, alguna vez habrás tenido problemas con el tema de dominios.
Como ya sabrás, está la IP pública (la que se ve desde fuera de tu red, y conecta con el router), y las IPs privadas (las de tu red local, que empiezan por 192.168.0&mldr;).
Esta tecnología de asignar varias &ldquo;IP privadas&rdquo; a una única &ldquo;IP pública&rdquo; se llama enmascaramiento o &ldquo;Traducción de Direcciones de Red&rdquo; (NAT por sus siglas en inglés).</p><p>Esto puede causar problemas si usas DNS para asignarle un nombre de dominio a un servicio. Pongamos que tienes un blog, y le asignas el dominio <code>blog.example.com</code> a la IP pública <code>1.2.3.4</code>. En tu rúter mapeas los puertos a tu dirección local <code>192.168.1.66</code>, pero cuando quieres acceder a <code>blog.example.com</code>&mldr; ¡no funciona! Te dirá que no se puede conectar al
host o algo así &ndash;¿Cómo que no? ¡Si lo tengo aquí al lado!&ndash;. Lo que pasa es que
tu ordenador se está intentando conectar a la dirección <code>1.2.3.4</code>, cuando lo que en
realidad quieres es acceder a la dirección <code>192.168.1.66</code>. Una alternativa sería modificar
el archivo hosts, pero si quieres modificarlo en todos los dispositivos de tu red local a la vez, existe
otra solución: ¡cambiar los DNS! Pero no el DNS de todo el mundo, porque dejaría de funcionar tu web para la gente que no esté en tu red local. El truco está en cambiar únicamente los DNS dentro de tu red local.</p><blockquote><p>Requisitos antes de seguir:</p><ul><li>Saber un poco qué es DNS y como cambiar los registros desde el panel de tu registrador de nombres de dominio.</li></ul></blockquote><h2 id=bind-tu-servidor-dns-de-confianza>BIND: Tu servidor DNS de confianza<a hidden class=anchor aria-hidden=true href=#bind-tu-servidor-dns-de-confianza>¶</a></h2><p>Bind es un servidor DNS, al que tú le preguntas un nombre de dominio (como google.es) y este te responde su dirección IP (<a href=http://142.250.200.131>142.250.200.131</a>). Lo más
seguro es que ya tengas un servidor bind en casa sin que tú lo sepas: el del rúter de la compañía telefónica. Y esque tener un servidor DNS en tu red local tiene muchas ventajas, sobre todo porque las consultas se hacen a un dispositivo que está a 10 metros, y no a un servidor a 100km.</p><p>Lo de sobreescribir algunas entradas es posible gracias al mecanismo <a href=https://dnsrpz.info>RPZ</a>, o <em>Políticas de Zonas de Respuesta</em>, que nos permite establecer espacios
de nombres de dominio especiales que sobreescriban a otros.</p><p>Ahora veremos como instalar y montar todo.</p><h2 id=instalar-bind>Instalar bind<a hidden class=anchor aria-hidden=true href=#instalar-bind>¶</a></h2><p>Dependiendo tu distro de linux o tu sistema operativo, el proceso de instalación será diferente. En este caso el tutorial se ha realizado con una máquina con Debian/Ubuntu.
Tan sólo es necesario instalar un par de paquetes, introducir en la terminal el siguiente comando.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo apt install bind9 bind9utils bind9-doc
</span></span></code></pre></div><h2 id=configurando-bind>Configurando BIND<a hidden class=anchor aria-hidden=true href=#configurando-bind>¶</a></h2><blockquote><p>Recuerda que para modificar estos archivos es necesario ser root o usar <code>sudo</code></p></blockquote><p>Lo primero es configurar una nueva zona a la que añadir nuestros subdominios, la vamos a llamar &ldquo;rpz&rdquo;, y estableceremos
su &ldquo;base de datos&rdquo; en el fichero <code>/etc/bind/db.rpz</code>. Para ello editamos el fichero <code>/etc/bind/named.conf.default-zones</code> y añadimos las siguientes líneas:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>zone &#34;rpz&#34; {
</span></span><span class=line><span class=cl>    type master;
</span></span><span class=line><span class=cl>    file &#34;/etc/bind/db.rpz&#34;;
</span></span><span class=line><span class=cl>}
</span></span></code></pre></div><p>Ahora editamos la base de datos donde se encuentran nuestros dominios (<code>/etc/bind/db.rpz</code>), añadiendo todos los registros que queramos.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dns data-lang=dns><span class=line><span class=cl><span class=c>; Fichero para mi LAN (Red de Área Local)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=na>$TTL</span><span class=w> </span><span class=sc>3600</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>; Estas dos entradas indican cual es el servidor DNS al que consultar (este mismo)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nc>@</span><span class=w>		</span><span class=k>IN</span><span class=w>	</span><span class=k>SOA</span><span class=w>	</span><span class=py>localhost. root.localhost. </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			      </span><span class=sc>2</span><span class=w>		</span><span class=c>; Serial</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			 </span><span class=sc>604800</span><span class=w>		</span><span class=c>; Refresh</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			  </span><span class=sc>86400</span><span class=w>		</span><span class=c>; Retry</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=sc>2419200</span><span class=w>		</span><span class=c>; Expire</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			 </span><span class=sc>604800</span><span class=w> </span><span class=p>)</span><span class=w>	</span><span class=c>; Negative Cache TTL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nc>@</span><span class=w>		</span><span class=k>IN</span><span class=w>	</span><span class=k>NS</span><span class=w>	</span><span class=py>localhost.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c>; Si establecemos un $ORIGIN, solo es necesario indicar el subdominio</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=na>$ORIGIN</span><span class=w> </span><span class=nc>example.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nc>nas</span><span class=w>                  </span><span class=k>A</span><span class=w>       </span><span class=mi>192.168.1.42</span><span class=w>              </span><span class=c>; Dirección IPv4 de nas.example.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nc>nas</span><span class=w>                  </span><span class=k>AAAA</span><span class=w>    </span><span class=il>fe80::1ff:fe23:4567:890a</span><span class=w>  </span><span class=c>; Dirección IPv6 de nas.example.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nc>ftp</span><span class=w>                  </span><span class=k>CNAME</span><span class=w>   </span><span class=err>nas</span><span class=w>                       </span><span class=c>; Un simple alias de ftp.example.com a nas.example.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=py>blog.example2.org. </span><span class=w>  </span><span class=k>A</span><span class=w>       </span><span class=mi>192.168.1.31</span><span class=w>              </span><span class=c>; También podemos añadir dominios completos</span><span class=w>
</span></span></span></code></pre></div><p>Además, el objetivo también es que todas las direcciones que tu servidor no conozca, se las pregunte a otro servidor. Para ello es necesario habilitar la recursión y especificar
los servidores a los que preguntar en caso de no encontrar la entrada en el rpz.</p><blockquote><p>Los servidores a los que preguntar pueden ser dados por tu ISP, también puede ser tu rúter (192.168.1.1). Yo recomiendo usar los de Google/Cloudflare por su fiabilidad y rapidez.</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>options</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=n>directory</span> <span class=s2>&#34;/var/cache/bind&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>recursion</span> <span class=n>yes</span><span class=p>;</span> <span class=c1># Habilitamos la recursión</span>
</span></span><span class=line><span class=cl>	<span class=n>listen</span><span class=o>-</span><span class=n>on</span> <span class=p>{</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>1.11</span><span class=p>;</span> <span class=p>};</span> <span class=c1># La dirección IP de nuestro servidor</span>
</span></span><span class=line><span class=cl>	<span class=n>allow</span><span class=o>-</span><span class=n>transfer</span> <span class=p>{</span> <span class=n>none</span><span class=p>;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>	<span class=n>response</span><span class=o>-</span><span class=n>policy</span> <span class=p>{</span> <span class=n>zone</span> <span class=s2>&#34;rpz&#34;</span><span class=p>;</span> <span class=p>}</span> <span class=k>break</span><span class=o>-</span><span class=n>dnssec</span> <span class=n>yes</span><span class=p>;</span> <span class=c1># La response policy zone</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>forwarders</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=mf>8.8</span><span class=o>.</span><span class=mf>8.8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=mf>8.8</span><span class=o>.</span><span class=mf>4.4</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=mf>1.1</span><span class=o>.</span><span class=mf>1.1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>dnssec</span><span class=o>-</span><span class=n>validation</span> <span class=n>auto</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>listen</span><span class=o>-</span><span class=n>on</span><span class=o>-</span><span class=n>v6</span> <span class=p>{</span> <span class=n>any</span><span class=p>;</span> <span class=p>};</span> <span class=c1># Puedes poner &#34;none&#34; si no quieres que funcione por ipv6</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><blockquote><p>Es importante decirle al servidor que ignore las peticiones &ldquo;seguras&rdquo;,
de no ser así, podría devolver una dirección firmada, pero incorrecta.</p></blockquote><h3 id=arrancando-el-servidor>Arrancando el servidor<a hidden class=anchor aria-hidden=true href=#arrancando-el-servidor>¶</a></h3><p>Para aplicar los cambios, iniciamos el servidor con systemctl</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>sudo systemctl enable --now bind9
</span></span></span></code></pre></div><p>Podemos probar que funciona con el comando <code>dig</code> (tal vez necesites instalarlo),
que nos permite hacer consultas a un servidor DNS en concreto (y no al por defecto)
del Sistema Operativo.</p><p>Primero probamos que funcionen las consultas normales, como a Google</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> dig google.es
</span></span><span class=line><span class=cl><span class=go>; &lt;&lt;&gt;&gt; DiG 9.16.23 &lt;&lt;&gt;&gt; google.es
</span></span></span><span class=line><span class=cl><span class=go>;; global options: +cmd
</span></span></span><span class=line><span class=cl><span class=go>;; Got answer:
</span></span></span><span class=line><span class=cl><span class=go>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 5016
</span></span></span><span class=line><span class=cl><span class=go>;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>;; OPT PSEUDOSECTION:
</span></span></span><span class=line><span class=cl><span class=go>; EDNS: version: 0, flags:; udp: 4096
</span></span></span><span class=line><span class=cl><span class=go>; COOKIE: 01db1f47a27adb9e90e4c7fb61c24bc2bf8c6a88296c3923 (good)
</span></span></span><span class=line><span class=cl><span class=go>;; QUESTION SECTION:
</span></span></span><span class=line><span class=cl><span class=go>;google.es.			IN	A
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>;; ANSWER SECTION:
</span></span></span><span class=line><span class=cl><span class=go>google.es.		300	IN	A	142.250.200.131
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>;; Query time: 39 msec
</span></span></span><span class=line><span class=cl><span class=go>;; SERVER: 192.168.1.11#53(192.168.1.11)
</span></span></span><span class=line><span class=cl><span class=go>;; WHEN: Tue Dec 21 22:48:50 CET 2021
</span></span></span><span class=line><span class=cl><span class=go>;; MSG SIZE  rcvd: 82
</span></span></span></code></pre></div><p>Y ahora probamos que funcione nuestro RPZ</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> dig chikyuu.ddavo.me @192.168.1.11
</span></span><span class=line><span class=cl><span class=go>; &lt;&lt;&gt;&gt; DiG 9.16.23 &lt;&lt;&gt;&gt; nas.example.com
</span></span></span><span class=line><span class=cl><span class=go>;; global options: +cmd
</span></span></span><span class=line><span class=cl><span class=go>;; Got answer:
</span></span></span><span class=line><span class=cl><span class=go>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 45881
</span></span></span><span class=line><span class=cl><span class=go>;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>;; OPT PSEUDOSECTION:
</span></span></span><span class=line><span class=cl><span class=go>; EDNS: version: 0, flags:; udp: 4096
</span></span></span><span class=line><span class=cl><span class=go>; COOKIE: d200bc3ba9741e2ab2c8935661c24b4b401d43ae997c39de (good)
</span></span></span><span class=line><span class=cl><span class=go>;; QUESTION SECTION:
</span></span></span><span class=line><span class=cl><span class=go>;nas.example.com.		IN	A
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>;; ANSWER SECTION:
</span></span></span><span class=line><span class=cl><span class=go>nas.example.com.	5	IN	A	192.168.1.42
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>;; Query time: 0 msec
</span></span></span><span class=line><span class=cl><span class=go>;; SERVER: 192.168.1.11#53(192.168.1.11)
</span></span></span><span class=line><span class=cl><span class=go>;; WHEN: Tue Dec 21 22:46:51 CET 2021
</span></span></span><span class=line><span class=cl><span class=go>;; MSG SIZE  rcvd: 89
</span></span></span></code></pre></div><p><strong>¡¡Parece que funciona!!</strong> La dirección IP que nos retorna es la dirección de área local, en lugar de la global.</p><h3 id=usando-el-servidor>Usando el servidor<a hidden class=anchor aria-hidden=true href=#usando-el-servidor>¶</a></h3><p>Sin embargo, no funciona desde el navegador, ni desde cualquier otro programa que no sea <code>dig</code>&mldr;</p><p>Es necesario configurar los dispositivos de tu red para que usen la nueva dirección. Cada sistema operativo es un mundo, pero tampoco suele ser algo muy difícil.</p><p>Si te es posible, puedes cambiarlo directamente desde el rúter,
para que se propague al resto de dispositivos automágicamente.</p><h2 id=fuentes-y-más-información>Fuentes y más información<a hidden class=anchor aria-hidden=true href=#fuentes-y-más-información>¶</a></h2><ul><li><a href=https://serverfault.com/questions/18748/overriding-some-dns-entries-in-bind-for-internal-networks>Serverfault.com: Overriding some DNS entries in BIND for internal networks</a></li><li><a href=https://en.wikipedia.org/wiki/Response_policy_zone>Wikipedia: Response policy zone</a></li><li><a href=https://dnsrpz.info/>dnsrpz.info</a></li></ul></div><footer class=post-footer></footer><div class=comments-separator></div><script type=text/javascript src=https://latest.cactus.chat/cactus.js></script><link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css><div id=comment-section></div><script>initComments({node:document.getElementById("comment-section"),defaultHomeserverUrl:"https://matrix.cactus.chat:8448",serverName:"cactus.chat",siteName:"blog.ddavo.me",commentSectionId:"/es/posts/tutorials/bind-override/"})</script></article></main><footer class=footer><span>© David Davó 2015 - 2024</span><span style=display:inline-block;margin-left:1em>
<a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA</a>
</span><span style=display:inline-block;margin-left:1em>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
    <a href=https://github.com/reorx/hugo-PaperModX/ rel=noopener target=_blank>PaperModX</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>(function(){const t=""=="1";if(t)return;let e=document.getElementById("theme-toggle");e.removeEventListener("click",toggleThemeListener),e.addEventListener("click",toggleThemeListener)})()</script><script>(function(){let e=document.getElementById("menu");e&&(e.scrollLeft=localStorage.getItem("menu-scroll-position"),e.onscroll=function(){localStorage.setItem("menu-scroll-position",e.scrollLeft)});const t=""=="1",n=""=="1";if(window.matchMedia("(prefers-reduced-motion: reduce)").matches||t||n)return;document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})})()</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>if(window.scrollListeners)for(const e of scrollListeners)window.removeEventListener("scroll",e);window.scrollListeners=[]</script><script src=/js/medium-zoom.min.js data-no-instant></script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copiar";function s(){t.innerText="¡copiado!",setTimeout(()=>{t.innerText="copiar"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script>(function(){const a="1"=="1";if(!a)return;if(!document.querySelector(".toc")){console.log("no toc found, ignore toc scroll");return}const r=window.scrollListeners,t=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id]"),n="active";let e=t[0];o(e).classList.add(n);const c=()=>{const s=[];for(const e of t)if(l(e)<5)s.push(e);else break;s.length>0?newActiveHeading=s[s.length-1]:newActiveHeading=t[0],e!=newActiveHeading&&(o(e).classList.remove(n),e=newActiveHeading,o(e).classList.add(n))};let s=null;const i=()=>{s!==null&&clearTimeout(s),s=setTimeout(c,50)};window.addEventListener("scroll",i,!1),r.push(i);function o(e){const t=encodeURI(e.getAttribute("id")).toLowerCase();return document.querySelector(`.toc ul li a[href="#${t}"]`)}function l(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect();return t.top}})()</script></body></html>